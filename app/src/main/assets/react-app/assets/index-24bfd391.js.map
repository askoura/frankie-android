{"version":3,"file":"index-24bfd391.js","sources":["../../src/pages/manage/AddEditUser/index.jsx"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\nimport { useNavigate, useParams } from \"react-router-dom\";\nimport {\n  Box,\n  Button,\n  Card,\n  TextField,\n  FormGroup,\n  FormControl,\n  FormLabel,\n  FormControlLabel,\n  FormHelperText,\n  Typography,\n  Checkbox,\n} from \"@mui/material\";\nimport { useTranslation } from \"react-i18next\";\nimport { Header } from \"~/components/manage/Header\";\nimport LoadingIndicator from \"~/components/common/LoadingIndicator\";\nimport UserService from \"~/services/UserService\";\nimport { PROCESSED_ERRORS, processError } from \"~/utils/errorsProcessor\";\nimport { routes } from \"~/routes\";\nimport styles from \"./AddEditUser.module.css\";\nimport ProcessedError from \"~/components/manage/ProcessedError\";\nimport { ROLES } from \"~/constants/roles\";\n\nfunction AddEditUser({ isEditing }) {\n  const { userId } = useParams();\n  const navigate = useNavigate();\n  const { t } = useTranslation(\"manage\");\n  const [processedError, setProcessedError] = useState(\"\");\n  const [showError, setShowError] = useState(false);\n\n  const [email, setEmail] = useState(\"\");\n  const [emailError, setEmailError] = useState(\"\");\n\n  const [firstName, setFirstName] = useState(\"\");\n  const [firstNameError, setFirstNameError] = useState(\"\");\n\n  const [lastName, setLastName] = useState(\"\");\n  const [lastNameError, setLastNameError] = useState(\"\");\n\n  const [roles, setRoles] = useState([]);\n  const [rolesError, setRolesError] = useState(\"\");\n\n  const onEmailChanged = (e) => {\n    setEmail(e.target.value);\n    setEmailError(\"\");\n  };\n\n  const onFirstNameChanged = (e) => {\n    setFirstName(e.target.value);\n    setFirstNameError(\"\");\n  };\n\n  const onLastChanged = (e) => {\n    setLastName(e.target.value);\n    setLastNameError(\"\");\n  };\n\n  const onRolesChanged = (e) => {\n    if (e.target.checked) {\n      setRoles([...roles, e.target.name]);\n    } else {\n      setRoles(roles.filter((role) => role !== e.target.name));\n    }\n  };\n\n  const validate = () => {\n    setEmailError(\"\");\n    setFirstNameError(\"\");\n    setLastNameError(\"\");\n    setRolesError(\"\");\n    if (firstName.length == 0) {\n      setFirstNameError(t(\"firstname_required\"));\n      return false;\n    }\n    if (lastName.length == 0) {\n      setLastNameError(t(\"lastname_required\"));\n      return false;\n    }\n    if (email.length == 0) {\n      setEmailError(t(\"email_required\"));\n      return false;\n    }\n    if (roles.length == 0) {\n      setRolesError(t(\"roles_required\"));\n      return false;\n    }\n\n    return true;\n  };\n\n  const [loading, setLoading] = useState(false);\n\n  const goUsers = () => {\n    navigate(routes.manageUsers);\n  };\n\n  const onSubmit = () => {\n    if (!validate()) {\n      return;\n    }\n\n    setLoading(true);\n    if (isEditing) {\n      UserService.updateUser({\n        userId,\n        data: { email, firstName, lastName, roles },\n      })\n        .then(() => {\n          goUsers();\n        })\n        .catch((e) => {\n          console.log(e);\n          const processed = processError(e);\n          console.log(processed);\n          switch (processed) {\n            case PROCESSED_ERRORS.NETWORK_ERR:\n            case PROCESSED_ERRORS.BACKEND_DOWN:\n              setShowError(true);\n              setProcessedError(processed);\n              break;\n            case PROCESSED_ERRORS.DUPLICATE_EMAIL:\n              setEmailError(t(`processed_errors.${processedError}`));\n              break;\n            default:\n              break;\n          }\n        })\n        .finally(() => {\n          setLoading(false);\n        });\n    } else {\n      UserService.createUser({ email, firstName, lastName, roles })\n        .then(() => {\n          goUsers();\n        })\n        .catch((e) => {\n          console.log(e);\n          const processed = processError(e);\n          console.log(processed);\n          switch (processed) {\n            case PROCESSED_ERRORS.NETWORK_ERR:\n            case PROCESSED_ERRORS.BACKEND_DOWN:\n              setShowError(true);\n              setProcessedError(processed);\n              break;\n            case PROCESSED_ERRORS.DUPLICATE_EMAIL:\n              setEmailError(t(`processed_errors.${processedError}`));\n              break;\n            default:\n              break;\n          }\n        })\n        .finally(() => {\n          setLoading(false);\n        });\n    }\n  };\n\n  useEffect(() => {\n    if (isEditing) {\n      setLoading(true);\n      UserService.getUser({ userId }).then((response) => {\n        const { email, firstName, lastName, roles } = response;\n        setEmail(email);\n        setFirstName(firstName);\n        setLastName(lastName);\n        setRoles(roles);\n        setLoading(false);\n      });\n    }\n  }, []);\n\n  return (\n    <Box className={styles.mainContainer}>\n      <Header />\n      {loading && <LoadingIndicator />}\n      {showError && (\n        <ProcessedError\n          error={processedError}\n          handleClose={() => setShowError(false)}\n        />\n      )}\n      <Card className={styles.createUserCard}>\n        <Typography variant=\"h4\">\n          {userId ? t(\"edit_user.title\") : t(\"add_user.title\")}\n        </Typography>\n        <FormGroup className={styles.formGroup}>\n          <TextField\n            error={firstNameError.length > 0}\n            required={true}\n            value={firstName}\n            id=\"firstName\"\n            label={t(\"label.first_name\")}\n            name=\"firstName\"\n            onChange={onFirstNameChanged}\n            variant=\"standard\"\n          />\n          <TextField\n            error={lastNameError?.length > 0}\n            id=\"lastName\"\n            value={lastName}\n            required={true}\n            onChange={onLastChanged}\n            label={t(\"label.last_name\")}\n            name=\"lastName\"\n            variant=\"standard\"\n          />\n          <TextField\n            required={true}\n            value={email}\n            error={\n              emailError?.length > 0 ||\n              processedError == PROCESSED_ERRORS.DUPLICATE_EMAIL\n            }\n            id=\"email\"\n            onChange={onEmailChanged}\n            label={t(\"label.email\")}\n            name=\"email\"\n            variant=\"standard\"\n          />\n\n          <FormControl sx={{ mt: \"20px\" }}>\n            <FormLabel id=\"radio-buttons-group-label\">\n              {t(\"add_user.roles\")}\n            </FormLabel>\n            <FormControlLabel\n              control={\n                <Checkbox\n                  checked={roles.indexOf(ROLES.SUPER_ADMIN) > -1}\n                  onChange={onRolesChanged}\n                  name={ROLES.SUPER_ADMIN}\n                />\n              }\n              label={t(\"label.super_admin\")}\n            />\n            <FormControlLabel\n              value={ROLES.SURVEY_ADMIN}\n              control={\n                <Checkbox\n                  checked={roles.indexOf(ROLES.SURVEY_ADMIN) > -1}\n                  onChange={onRolesChanged}\n                  name={ROLES.SURVEY_ADMIN}\n                />\n              }\n              label={t(\"label.survey_admin\")}\n            />\n            <FormControlLabel\n              value={ROLES.ANALYST}\n              control={\n                <Checkbox\n                  checked={roles.indexOf(ROLES.ANALYST) > -1}\n                  onChange={onRolesChanged}\n                  name={ROLES.ANALYST}\n                />\n              }\n              label={t(\"label.analyst\")}\n            />\n            <FormControlLabel\n              value={ROLES.SURVEYOR}\n              control={\n                <Checkbox\n                  checked={roles.indexOf(ROLES.SURVEYOR) > -1}\n                  onChange={onRolesChanged}\n                  name={ROLES.SURVEYOR}\n                />\n              }\n              label={t(\"label.surveyor\")}\n            />\n          </FormControl>\n          {(firstNameError || lastNameError || emailError || rolesError) && (\n            <FormHelperText className={styles.errorText}>\n              {firstNameError || lastNameError || emailError || rolesError}\n            </FormHelperText>\n          )}\n        </FormGroup>\n        <Box sx={{ display: \"flex\", justifyContent: \"flex-end\", mt: \"40px\" }}>\n          <Button onClick={goUsers}>{t(\"add_user.cancel\")}</Button>\n          <Button onClick={onSubmit}>{t(\"add_user.save\")}</Button>\n        </Box>\n      </Card>\n    </Box>\n  );\n}\n\nexport default AddEditUser;\n"],"names":["useState","useEffect","email","firstName","lastName","roles","jsxs","jsx"],"mappings":"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"}