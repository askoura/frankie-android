import{P as Q,Q as Y,r as k,O as Z,j as M}from"./index-_S4YwDqB.js";import{w as H,y as tt,H as et,J as nt,K as V,k as $,L as it,z as ot}from"./Android-C-a1KXUo.js";import{p as at}from"./index-g0p8o0B7.js";var G={exports:{}};/*!
 * Signature Pad v2.3.2
 * https://github.com/szimek/signature_pad
 *
 * Copyright 2017 Szymon Nowak
 * Released under the MIT license
 *
 * The main idea and some parts of the code (e.g. drawing variable width Bézier curve) are taken from:
 * http://corner.squareup.com/2012/07/smoother-signatures.html
 *
 * Implementation of interpolation using cubic Bézier curves is taken from:
 * http://benknowscode.wordpress.com/2012/09/14/path-interpolation-using-cubic-bezier-and-control-point-estimation-in-javascript
 *
 * Algorithm for approximated length of a Bézier curve is taken from:
 * http://www.lemoda.net/maths/bezier-length/index.html
 *
 */function O(t,i,n){this.x=t,this.y=i,this.time=n||new Date().getTime()}O.prototype.velocityFrom=function(t){return this.time!==t.time?this.distanceTo(t)/(this.time-t.time):1};O.prototype.distanceTo=function(t){return Math.sqrt(Math.pow(this.x-t.x,2)+Math.pow(this.y-t.y,2))};O.prototype.equals=function(t){return this.x===t.x&&this.y===t.y&&this.time===t.time};function F(t,i,n,e){this.startPoint=t,this.control1=i,this.control2=n,this.endPoint=e}F.prototype.length=function(){for(var t=10,i=0,n=void 0,e=void 0,o=0;o<=t;o+=1){var s=o/t,r=this._point(s,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),h=this._point(s,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y);if(o>0){var u=r-n,a=h-e;i+=Math.sqrt(u*u+a*a)}n=r,e=h}return i};F.prototype._point=function(t,i,n,e,o){return i*(1-t)*(1-t)*(1-t)+3*n*(1-t)*(1-t)*t+3*e*(1-t)*t*t+o*t*t*t};function rt(t,i,n){var e,o,s,r=null,h=0;n||(n={});var u=function(){h=n.leading===!1?0:Date.now(),r=null,s=t.apply(e,o),r||(e=o=null)};return function(){var a=Date.now();!h&&n.leading===!1&&(h=a);var l=i-(a-h);return e=this,o=arguments,l<=0||l>i?(r&&(clearTimeout(r),r=null),h=a,s=t.apply(e,o),r||(e=o=null)):!r&&n.trailing!==!1&&(r=setTimeout(u,l)),s}}function m(t,i){var n=this,e=i||{};this.velocityFilterWeight=e.velocityFilterWeight||.7,this.minWidth=e.minWidth||.5,this.maxWidth=e.maxWidth||2.5,this.throttle="throttle"in e?e.throttle:16,this.minDistance="minDistance"in e?e.minDistance:5,this.throttle?this._strokeMoveUpdate=rt(m.prototype._strokeUpdate,this.throttle):this._strokeMoveUpdate=m.prototype._strokeUpdate,this.dotSize=e.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=e.penColor||"black",this.backgroundColor=e.backgroundColor||"rgba(0,0,0,0)",this.onBegin=e.onBegin,this.onEnd=e.onEnd,this._canvas=t,this._ctx=t.getContext("2d"),this.clear(),this._handleMouseDown=function(o){o.which===1&&(n._mouseButtonDown=!0,n._strokeBegin(o))},this._handleMouseMove=function(o){n._mouseButtonDown&&n._strokeMoveUpdate(o)},this._handleMouseUp=function(o){o.which===1&&n._mouseButtonDown&&(n._mouseButtonDown=!1,n._strokeEnd(o))},this._handleTouchStart=function(o){if(o.targetTouches.length===1){var s=o.changedTouches[0];n._strokeBegin(s)}},this._handleTouchMove=function(o){o.preventDefault();var s=o.targetTouches[0];n._strokeMoveUpdate(s)},this._handleTouchEnd=function(o){var s=o.target===n._canvas;s&&(o.preventDefault(),n._strokeEnd(o))},this.on()}m.prototype.clear=function(){var t=this._ctx,i=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,i.width,i.height),t.fillRect(0,0,i.width,i.height),this._data=[],this._reset(),this._isEmpty=!0};m.prototype.fromDataURL=function(t){var i=this,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},e=new Image,o=n.ratio||window.devicePixelRatio||1,s=n.width||this._canvas.width/o,r=n.height||this._canvas.height/o;this._reset(),e.src=t,e.onload=function(){i._ctx.drawImage(e,0,0,s,r)},this._isEmpty=!1};m.prototype.toDataURL=function(t){var i;switch(t){case"image/svg+xml":return this._toSVG();default:for(var n=arguments.length,e=Array(n>1?n-1:0),o=1;o<n;o++)e[o-1]=arguments[o];return(i=this._canvas).toDataURL.apply(i,[t].concat(e))}};m.prototype.on=function(){this._handleMouseEvents(),this._handleTouchEvents()};m.prototype.off=function(){this._canvas.removeEventListener("mousedown",this._handleMouseDown),this._canvas.removeEventListener("mousemove",this._handleMouseMove),document.removeEventListener("mouseup",this._handleMouseUp),this._canvas.removeEventListener("touchstart",this._handleTouchStart),this._canvas.removeEventListener("touchmove",this._handleTouchMove),this._canvas.removeEventListener("touchend",this._handleTouchEnd)};m.prototype.isEmpty=function(){return this._isEmpty};m.prototype._strokeBegin=function(t){this._data.push([]),this._reset(),this._strokeUpdate(t),typeof this.onBegin=="function"&&this.onBegin(t)};m.prototype._strokeUpdate=function(t){var i=t.clientX,n=t.clientY,e=this._createPoint(i,n),o=this._data[this._data.length-1],s=o&&o[o.length-1],r=s&&e.distanceTo(s)<this.minDistance;if(!(s&&r)){var h=this._addPoint(e),u=h.curve,a=h.widths;u&&a&&this._drawCurve(u,a.start,a.end),this._data[this._data.length-1].push({x:e.x,y:e.y,time:e.time,color:this.penColor})}};m.prototype._strokeEnd=function(t){var i=this.points.length>2,n=this.points[0];if(!i&&n&&this._drawDot(n),n){var e=this._data[this._data.length-1],o=e[e.length-1];n.equals(o)||e.push({x:n.x,y:n.y,time:n.time,color:this.penColor})}typeof this.onEnd=="function"&&this.onEnd(t)};m.prototype._handleMouseEvents=function(){this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",this._handleMouseDown),this._canvas.addEventListener("mousemove",this._handleMouseMove),document.addEventListener("mouseup",this._handleMouseUp)};m.prototype._handleTouchEvents=function(){this._canvas.style.msTouchAction="none",this._canvas.style.touchAction="none",this._canvas.addEventListener("touchstart",this._handleTouchStart),this._canvas.addEventListener("touchmove",this._handleTouchMove),this._canvas.addEventListener("touchend",this._handleTouchEnd)};m.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._ctx.fillStyle=this.penColor};m.prototype._createPoint=function(t,i,n){var e=this._canvas.getBoundingClientRect();return new O(t-e.left,i-e.top,n||new Date().getTime())};m.prototype._addPoint=function(t){var i=this.points,n=void 0;if(i.push(t),i.length>2){i.length===3&&i.unshift(i[0]),n=this._calculateCurveControlPoints(i[0],i[1],i[2]);var e=n.c2;n=this._calculateCurveControlPoints(i[1],i[2],i[3]);var o=n.c1,s=new F(i[1],e,o,i[2]),r=this._calculateCurveWidths(s);return i.shift(),{curve:s,widths:r}}return{}};m.prototype._calculateCurveControlPoints=function(t,i,n){var e=t.x-i.x,o=t.y-i.y,s=i.x-n.x,r=i.y-n.y,h={x:(t.x+i.x)/2,y:(t.y+i.y)/2},u={x:(i.x+n.x)/2,y:(i.y+n.y)/2},a=Math.sqrt(e*e+o*o),l=Math.sqrt(s*s+r*r),f=h.x-u.x,v=h.y-u.y,y=l/(a+l),w={x:u.x+f*y,y:u.y+v*y},x=i.x-w.x,p=i.y-w.y;return{c1:new O(h.x+x,h.y+p),c2:new O(u.x+x,u.y+p)}};m.prototype._calculateCurveWidths=function(t){var i=t.startPoint,n=t.endPoint,e={start:null,end:null},o=this.velocityFilterWeight*n.velocityFrom(i)+(1-this.velocityFilterWeight)*this._lastVelocity,s=this._strokeWidth(o);return e.start=this._lastWidth,e.end=s,this._lastVelocity=o,this._lastWidth=s,e};m.prototype._strokeWidth=function(t){return Math.max(this.maxWidth/(t+1),this.minWidth)};m.prototype._drawPoint=function(t,i,n){var e=this._ctx;e.moveTo(t,i),e.arc(t,i,n,0,2*Math.PI,!1),this._isEmpty=!1};m.prototype._drawCurve=function(t,i,n){var e=this._ctx,o=n-i,s=Math.floor(t.length());e.beginPath();for(var r=0;r<s;r+=1){var h=r/s,u=h*h,a=u*h,l=1-h,f=l*l,v=f*l,y=v*t.startPoint.x;y+=3*f*h*t.control1.x,y+=3*l*u*t.control2.x,y+=a*t.endPoint.x;var w=v*t.startPoint.y;w+=3*f*h*t.control1.y,w+=3*l*u*t.control2.y,w+=a*t.endPoint.y;var x=i+a*o;this._drawPoint(y,w,x)}e.closePath(),e.fill()};m.prototype._drawDot=function(t){var i=this._ctx,n=typeof this.dotSize=="function"?this.dotSize():this.dotSize;i.beginPath(),this._drawPoint(t.x,t.y,n),i.closePath(),i.fill()};m.prototype._fromData=function(t,i,n){for(var e=0;e<t.length;e+=1){var o=t[e];if(o.length>1)for(var s=0;s<o.length;s+=1){var r=o[s],h=new O(r.x,r.y,r.time),u=r.color;if(s===0)this.penColor=u,this._reset(),this._addPoint(h);else if(s!==o.length-1){var a=this._addPoint(h),l=a.curve,f=a.widths;l&&f&&i(l,f,u)}}else{this._reset();var v=o[0];n(v)}}};m.prototype._toSVG=function(){var t=this,i=this._data,n=this._canvas,e=Math.max(window.devicePixelRatio||1,1),o=0,s=0,r=n.width/e,h=n.height/e,u=document.createElementNS("http://www.w3.org/2000/svg","svg");u.setAttributeNS(null,"width",n.width),u.setAttributeNS(null,"height",n.height),this._fromData(i,function(d,E,S){var D=document.createElement("path");if(!isNaN(d.control1.x)&&!isNaN(d.control1.y)&&!isNaN(d.control2.x)&&!isNaN(d.control2.y)){var R="M "+d.startPoint.x.toFixed(3)+","+d.startPoint.y.toFixed(3)+" "+("C "+d.control1.x.toFixed(3)+","+d.control1.y.toFixed(3)+" ")+(d.control2.x.toFixed(3)+","+d.control2.y.toFixed(3)+" ")+(d.endPoint.x.toFixed(3)+","+d.endPoint.y.toFixed(3));D.setAttribute("d",R),D.setAttribute("stroke-width",(E.end*2.25).toFixed(3)),D.setAttribute("stroke",S),D.setAttribute("fill","none"),D.setAttribute("stroke-linecap","round"),u.appendChild(D)}},function(d){var E=document.createElement("circle"),S=typeof t.dotSize=="function"?t.dotSize():t.dotSize;E.setAttribute("r",S),E.setAttribute("cx",d.x),E.setAttribute("cy",d.y),E.setAttribute("fill",d.color),u.appendChild(E)});var a="data:image/svg+xml;base64,",l='<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"'+(' viewBox="'+o+" "+s+" "+r+" "+h+'"')+(' width="'+r+'"')+(' height="'+h+'"')+">",f=u.innerHTML;if(f===void 0){var v=document.createElement("dummy"),y=u.childNodes;v.innerHTML="";for(var w=0;w<y.length;w+=1)v.appendChild(y[w].cloneNode(!0));f=v.innerHTML}var x="</svg>",p=l+f+x;return a+btoa(p)};m.prototype.fromData=function(t){var i=this;this.clear(),this._fromData(t,function(n,e){return i._drawCurve(n,e.start,e.end)},function(n){return i._drawDot(n)}),this._data=t};m.prototype.toData=function(){return this._data};const st=Object.freeze(Object.defineProperty({__proto__:null,default:m},Symbol.toStringTag,{value:"Module"})),ht=Q(st);var U={exports:{}},X;function ut(){return X||(X=1,function(t,i){(function(n,e){t.exports=e()})(Y,function(){return function(n){function e(s){if(o[s])return o[s].exports;var r=o[s]={exports:{},id:s,loaded:!1};return n[s].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var o={};return e.m=n,e.c=o,e.p="",e(0)}([function(n,e){function o(a){var l=a.getContext("2d"),f=a.width,v=a.height,y=l.getImageData(0,0,f,v).data,w=h(!0,f,v,y),x=h(!1,f,v,y),p=u(!0,f,v,y),d=u(!1,f,v,y),E=d-p+1,S=x-w+1,D=l.getImageData(p,w,E,S);return a.width=E,a.height=S,l.clearRect(0,0,E,S),l.putImageData(D,0,0),a}function s(a,l,f,v){return{red:v[4*(f*l+a)],green:v[4*(f*l+a)+1],blue:v[4*(f*l+a)+2],alpha:v[4*(f*l+a)+3]}}function r(a,l,f,v){return s(a,l,f,v).alpha}function h(a,l,f,v){for(var y=a?1:-1,w=a?0:f-1,x=w;a?x<f:x>-1;x+=y)for(var p=0;p<l;p++)if(r(p,x,l,v))return x;return null}function u(a,l,f,v){for(var y=a?1:-1,w=a?0:l-1,x=w;a?x<l:x>-1;x+=y)for(var p=0;p<f;p++)if(r(x,p,l,v))return x;return null}Object.defineProperty(e,"__esModule",{value:!0}),e.default=o}])})}(U)),U.exports}(function(t,i){(function(n,e){t.exports=e(at,k,ht,ut())})(Y,function(n,e,o,s){return function(r){function h(a){if(u[a])return u[a].exports;var l=u[a]={exports:{},id:a,loaded:!1};return r[a].call(l.exports,l,l.exports,h),l.loaded=!0,l.exports}var u={};return h.m=r,h.c=u,h.p="",h(0)}([function(r,h,u){function a(g){return g&&g.__esModule?g:{default:g}}function l(g,_){var C={};for(var b in g)_.indexOf(b)>=0||Object.prototype.hasOwnProperty.call(g,b)&&(C[b]=g[b]);return C}function f(g,_){if(!(g instanceof _))throw new TypeError("Cannot call a class as a function")}function v(g,_){if(!g)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!_||typeof _!="object"&&typeof _!="function"?g:_}function y(g,_){if(typeof _!="function"&&_!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof _);g.prototype=Object.create(_&&_.prototype,{constructor:{value:g,enumerable:!1,writable:!0,configurable:!0}}),_&&(Object.setPrototypeOf?Object.setPrototypeOf(g,_):g.__proto__=_)}Object.defineProperty(h,"__esModule",{value:!0});var w=Object.assign||function(g){for(var _=1;_<arguments.length;_++){var C=arguments[_];for(var b in C)Object.prototype.hasOwnProperty.call(C,b)&&(g[b]=C[b])}return g},x=function(){function g(_,C){for(var b=0;b<C.length;b++){var c=C[b];c.enumerable=c.enumerable||!1,c.configurable=!0,"value"in c&&(c.writable=!0),Object.defineProperty(_,c.key,c)}}return function(_,C,b){return C&&g(_.prototype,C),b&&g(_,b),_}}(),p=u(1),d=a(p),E=u(2),S=a(E),D=u(3),R=a(D),J=u(4),K=a(J),j=function(g){function _(){var C,b,c,A;f(this,_);for(var N=arguments.length,q=Array(N),z=0;z<N;z++)q[z]=arguments[z];return b=c=v(this,(C=_.__proto__||Object.getPrototypeOf(_)).call.apply(C,[this].concat(q))),c._sigPad=null,c._excludeOurProps=function(){var P=c.props,T=(P.canvasProps,P.clearOnResize,l(P,["canvasProps","clearOnResize"]));return T},c.getCanvas=function(){return c._canvas},c.getTrimmedCanvas=function(){var P=document.createElement("canvas");return P.width=c._canvas.width,P.height=c._canvas.height,P.getContext("2d").drawImage(c._canvas,0,0),(0,K.default)(P)},c.getSignaturePad=function(){return c._sigPad},c._checkClearOnResize=function(){c.props.clearOnResize&&c._resizeCanvas()},c._resizeCanvas=function(){var P=c.props.canvasProps||{},T=P.width,I=P.height;if(!T||!I){var W=c._canvas,L=Math.max(window.devicePixelRatio||1,1);T||(W.width=W.offsetWidth*L),I||(W.height=W.offsetHeight*L),W.getContext("2d").scale(L,L),c.clear()}},c.on=function(){return window.addEventListener("resize",c._checkClearOnResize),c._sigPad.on()},c.off=function(){return window.removeEventListener("resize",c._checkClearOnResize),c._sigPad.off()},c.clear=function(){return c._sigPad.clear()},c.isEmpty=function(){return c._sigPad.isEmpty()},c.fromDataURL=function(P,T){return c._sigPad.fromDataURL(P,T)},c.toDataURL=function(P,T){return c._sigPad.toDataURL(P,T)},c.fromData=function(P){return c._sigPad.fromData(P)},c.toData=function(){return c._sigPad.toData()},A=b,v(c,A)}return y(_,g),x(_,[{key:"componentDidMount",value:function(){this._sigPad=new R.default(this._canvas,this._excludeOurProps()),this._resizeCanvas(),this.on()}},{key:"componentWillUnmount",value:function(){this.off()}},{key:"componentDidUpdate",value:function(){Object.assign(this._sigPad,this._excludeOurProps())}},{key:"render",value:function(){var C=this,b=this.props.canvasProps;return S.default.createElement("canvas",w({ref:function(c){C._canvas=c}},b))}}]),_}(E.Component);j.propTypes={velocityFilterWeight:d.default.number,minWidth:d.default.number,maxWidth:d.default.number,minDistance:d.default.number,dotSize:d.default.oneOfType([d.default.number,d.default.func]),penColor:d.default.string,throttle:d.default.number,onEnd:d.default.func,onBegin:d.default.func,canvasProps:d.default.object,clearOnResize:d.default.bool},j.defaultProps={clearOnResize:!0},h.default=j},function(r,h){r.exports=n},function(r,h){r.exports=e},function(r,h){r.exports=o},function(r,h){r.exports=s}])})})(G);var ct=G.exports;const lt=Z(ct),dt="_signatureCanvas_1bkvb_1",ft="_container_1bkvb_10",vt="_buttonContainer_1bkvb_14",B={signatureCanvas:dt,container:ft,buttonContainer:vt};function gt(t){const[i,n]=k.useState(!1),[e,o]=k.useState(!1),[s,r]=k.useState(void 0),h=H(p=>{let d=p.runState.values[t.component.qualifiedCode];return d==null?void 0:d.value}),u=k.useRef(null),[a,l]=k.useState(400);k.useEffect(()=>{var p;l((p=u==null?void 0:u.current)==null?void 0:p.offsetWidth)},[u]),k.useEffect(()=>{const p=()=>{var d;l((d=u==null?void 0:u.current)==null?void 0:d.offsetWidth)};return window.addEventListener("resize",p),()=>{window.removeEventListener("resize",p)}},[]);const f=H(p=>p.runState.preview),v=k.useRef(),y=tt(),w=()=>{var p;(p=v.current)==null||p.clear(),r(void 0),o(!1),n(!1)},x=()=>{const p=v.current.toDataURL("image/png");it(t.component.qualifiedCode,f,p,"signature-".concat(t.component.qualifiedCode,".png")).then(d=>{y(ot({componentCode:t.component.qualifiedCode,value:d}))}).catch(d=>{console.error(d)})};return k.useEffect(()=>{h&&h.stored_filename&&(o(!0),et(nt(h.stored_filename)).then(p=>{n(!1),r(p)}))},[h]),M.jsxs(M.Fragment,{children:[M.jsx(V,{sx:{backgroundColor:"background.default"},className:B.container,children:M.jsx(V,{ref:u,sx:{maxWidth:Math.min(a,400)+"px"},className:B.signatureCanvas,children:s?M.jsx("img",{src:s,style:{width:Math.min(a,400)+"px",height:"200px"}}):M.jsx(lt,{penColor:"red",clearOnResize:!0,onBegin:()=>{n(!0),o(!0)},ref:v,canvasProps:{width:Math.min(a,400),height:200}})})}),M.jsx("br",{}),M.jsxs("div",{className:B.buttonContainer,children:[M.jsx($,{onClick:()=>w(),disabled:!e,children:"Clear"}),M.jsx($,{onClick:()=>x(),disabled:!i,children:"Submit"})]})]})}export{gt as default};
