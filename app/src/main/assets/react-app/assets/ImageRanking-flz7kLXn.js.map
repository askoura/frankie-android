{"version":3,"file":"ImageRanking-flz7kLXn.js","sources":["../../src/components/Questions/ImageRanking/ImageRanking.jsx"],"sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\nimport styles from \"./ImageRanking.module.css\";\nimport { useTheme } from \"@emotion/react\";\nimport { Box, Grid } from \"@mui/material\";\nimport { shallowEqual, useDispatch } from \"react-redux\";\nimport { valueChange } from \"~/state/runState\";\nimport { buildResourceUrl } from \"~/networking/common\";\nimport { useSelector } from \"react-redux\";\nimport { setDirty } from \"~/state/templateState\";\nimport { rtlLanguage } from \"~/utils/common\";\n\nfunction ImageRanking(props) {\n  const values = useSelector((state) => {\n    let valuesMap = {};\n    props.component.answers.forEach((element) => {\n      valuesMap[element.qualifiedCode] =\n        state.runState.values[element.qualifiedCode].value;\n    });\n    return valuesMap;\n  }, shallowEqual);\n  const dispatch = useDispatch();\n\n  const containerRef = useRef(null);\n  const [width, setWidth] = useState(800);\n  useEffect(() => {\n    setWidth(containerRef?.current?.offsetWidth);\n  }, [containerRef]);\n  const imageWidth =\n    (width - props.component.columns * props.component.spacing * 2) /\n    props.component.columns;\n  const imageHeight = imageWidth / (props.component.imageAspectRatio || 1);\n\n  useEffect(() => {\n    const resizeListener = () => {\n      // change width from the state object\n      setWidth(containerRef?.current?.offsetWidth);\n    };\n    // set resize listener\n    window.addEventListener(\"resize\", resizeListener);\n\n    // clean up function\n    return () => {\n      // remove resize listener\n      window.removeEventListener(\"resize\", resizeListener);\n    };\n  }, []);\n\n  const onItemClick = (componentCode) => {\n    dispatch(setDirty(props.component.qualifiedCode));\n    dispatch(setDirty(props.parentCode));\n    if (+values[componentCode] > 0) {\n      dispatch(valueChange({ componentCode, undefined }));\n    } else {\n      let keys = Object.keys(values);\n      let allValues = keys.map((key) => values[key]);\n      for (var i = 1; i <= keys.length; i++) {\n        if (!allValues.includes(i)) {\n          dispatch(valueChange({ componentCode, value: i }));\n          return;\n        }\n      }\n    }\n  };\n\n  const lang = useSelector((state) => {\n    return state.runState.values[\"Survey\"].lang;\n  });\n  const isRtl = rtlLanguage.includes(lang);\n\n  return (\n    <Grid\n      ref={containerRef}\n      container\n      className={styles.imageGrid}\n    >\n      {props.component.answers.map((option) => {\n        return (\n          <ImageRankingItem\n            option={option}\n            spacing={props.component.spacing}\n            columns={props.component.columns}\n            hideText={props.component.hideText}\n            onClick={() => onItemClick(option.qualifiedCode)}\n            parentCode={props.component.qualifiedCode}\n            imageHeight={imageHeight}\n            imageWidth={imageWidth}\n            key={option.qualifiedCode}\n          />\n        );\n      })}\n    </Grid>\n  );\n}\n\nfunction ImageRankingItem(props) {\n  const theme = useTheme();\n  const state = useSelector((state) => {\n    let answerState = state.runState.values[props.option.qualifiedCode];\n    return {\n      showAnswer:\n        typeof answerState?.relevance == \"undefined\" || answerState.relevance,\n      value: answerState?.value || 0,\n    };\n  }, shallowEqual);\n\n  const backgroundImage = props.option.resources?.image\n    ? `url('${buildResourceUrl(props.option.resources.image)}')`\n    : \"0\";\n\n  return (\n    <Grid key={props.option.code} item xs={12 / props.columns}>\n      <Box\n        className={styles.imageContainer}\n        onClick={() => props.onClick()}\n        display=\"flex\"\n        justifyContent=\"center\"\n        alignItems=\"center\"\n        style={{\n          backgroundImage: backgroundImage,\n          backgroundColor: theme.palette.background.default,\n          margin: props.spacing + \"px\",\n\n          boxShadow: 2,\n          height: props.imageHeight + \"px\",\n          border: state.checked\n            ? `2px solid ${theme.palette.primary.main}`\n            : \"2px solid transparent\",\n        }}\n      >\n        {state.value > 0 && (\n          <div\n            style={{\n              height: Math.min(props.imageHeight, props.imageWidth) + \"px\",\n              width: Math.min(props.imageHeight, props.imageWidth) + \"px\",\n              borderRadius:\n                Math.min(props.imageHeight, props.imageWidth) / 2 + \"px\",\n              fontSize:\n                Math.min(props.imageHeight, props.imageWidth) / 2 + \"px\",\n            }}\n            className={styles.rankContainer}\n          >\n            <span\n              className={styles.rankValue}\n              style={{\n                color: theme.palette.primary.main,\n              }}\n            >\n              {state.value}\n            </span>\n          </div>\n        )}\n      </Box>\n      {!props.hideText && (\n        <Box\n          sx={{\n            fontFamily: theme.textStyles.text.font,\n            color: theme.textStyles.text.color,\n            fontSize: theme.textStyles.text.size,\n          }}\n        >\n          {props.option.content?.label}\n        </Box>\n      )}\n    </Grid>\n  );\n}\n\nexport default ImageRanking;\n"],"names":["useRef","useState","useEffect","jsx","state"],"mappings":";;;;;;;;;;;;;AAWA,SAAS,aAAa,OAAO;AACrB,QAAA,SAAS,YAAY,CAAC,UAAU;AACpC,QAAI,YAAY,CAAA;AAChB,UAAM,UAAU,QAAQ,QAAQ,CAAC,YAAY;AACjC,gBAAA,QAAQ,aAAa,IAC7B,MAAM,SAAS,OAAO,QAAQ,aAAa,EAAE;AAAA,IAAA,CAChD;AACM,WAAA;AAAA,KACN,YAAY;AACf,QAAM,WAAW;AAEX,QAAA,eAAeA,oBAAO,IAAI;AAChC,QAAM,CAAC,OAAO,QAAQ,IAAIC,sBAAS,GAAG;AACtCC,eAAAA,UAAU,MAAM;;AACL,cAAA,kDAAc,YAAd,mBAAuB,WAAW;AAAA,EAAA,GAC1C,CAAC,YAAY,CAAC;AACX,QAAA,cACH,QAAQ,MAAM,UAAU,UAAU,MAAM,UAAU,UAAU,KAC7D,MAAM,UAAU;AAClB,QAAM,cAAc,cAAc,MAAM,UAAU,oBAAoB;AAEtEA,eAAAA,UAAU,MAAM;AACd,UAAM,iBAAiB,MAAM;;AAElB,gBAAA,kDAAc,YAAd,mBAAuB,WAAW;AAAA,IAAA;AAGtC,WAAA,iBAAiB,UAAU,cAAc;AAGhD,WAAO,MAAM;AAEJ,aAAA,oBAAoB,UAAU,cAAc;AAAA,IAAA;AAAA,EAEvD,GAAG,CAAE,CAAA;AAEC,QAAA,cAAc,CAAC,kBAAkB;AACrC,aAAS,SAAS,MAAM,UAAU,aAAa,CAAC;AACvC,aAAA,SAAS,MAAM,UAAU,CAAC;AACnC,QAAI,CAAC,OAAO,aAAa,IAAI,GAAG;AAC9B,eAAS,YAAY,EAAE,eAAe,WAAA,OAAW,CAAA,CAAC;AAAA,IAAA,OAC7C;AACD,UAAA,OAAO,OAAO,KAAK,MAAM;AAC7B,UAAI,YAAY,KAAK,IAAI,CAAC,QAAQ,OAAO,GAAG,CAAC;AAC7C,eAAS,IAAI,GAAG,KAAK,KAAK,QAAQ,KAAK;AACrC,YAAI,CAAC,UAAU,SAAS,CAAC,GAAG;AAC1B,mBAAS,YAAY,EAAE,eAAe,OAAO,EAAG,CAAA,CAAC;AACjD;AAAA,QACF;AAAA,MACF;AAAA,IACF;AAAA,EAAA;AAGW,cAAY,CAAC,UAAU;AAClC,WAAO,MAAM,SAAS,OAAO,QAAQ,EAAE;AAAA,EAAA,CACxC;AAIC,SAAAC,kCAAA;AAAA,IAAC;AAAA,IAAA;AAAA,MACC,KAAK;AAAA,MACL,WAAS;AAAA,MACT,WAAW,OAAO;AAAA,MAEjB,UAAM,MAAA,UAAU,QAAQ,IAAI,CAAC,WAAW;AAErC,eAAAA,kCAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC;AAAA,YACA,SAAS,MAAM,UAAU;AAAA,YACzB,SAAS,MAAM,UAAU;AAAA,YACzB,UAAU,MAAM,UAAU;AAAA,YAC1B,SAAS,MAAM,YAAY,OAAO,aAAa;AAAA,YAC/C,YAAY,MAAM,UAAU;AAAA,YAC5B;AAAA,YACA;AAAA,UAAA;AAAA,UACK,OAAO;AAAA,QAAA;AAAA,MACd,CAEH;AAAA,IAAA;AAAA,EAAA;AAGP;AAEA,SAAS,iBAAiB,OAAO;;AAC/B,QAAM,QAAQ;AACR,QAAA,QAAQ,YAAY,CAACC,WAAU;AACnC,QAAI,cAAcA,OAAM,SAAS,OAAO,MAAM,OAAO,aAAa;AAC3D,WAAA;AAAA,MACL,YACE,QAAO,2CAAa,cAAa,eAAe,YAAY;AAAA,MAC9D,QAAO,2CAAa,UAAS;AAAA,IAAA;AAAA,KAE9B,YAAY;AAEf,QAAM,oBAAkB,WAAM,OAAO,cAAb,mBAAwB,SAC5C,QAAQ,wBAAiB,MAAM,OAAO,UAAU,KAAK,GAAC,QACtD;AAEJ,gDACG,MAA6B,EAAA,MAAI,MAAC,IAAI,KAAK,MAAM,SAChD,UAAA;AAAA,IAAAD,kCAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,WAAW,OAAO;AAAA,QAClB,SAAS,MAAM,MAAM,QAAQ;AAAA,QAC7B,SAAQ;AAAA,QACR,gBAAe;AAAA,QACf,YAAW;AAAA,QACX,OAAO;AAAA,UACL;AAAA,UACA,iBAAiB,MAAM,QAAQ,WAAW;AAAA,UAC1C,QAAQ,MAAM,UAAU;AAAA,UAExB,WAAW;AAAA,UACX,QAAQ,MAAM,cAAc;AAAA,UAC5B,QAAQ,MAAM,UACV,aAAa,aAAM,QAAQ,QAAQ,QACnC;AAAA,QACN;AAAA,QAEC,UAAA,MAAM,QAAQ,KACbA,kCAAA;AAAA,UAAC;AAAA,UAAA;AAAA,YACC,OAAO;AAAA,cACL,QAAQ,KAAK,IAAI,MAAM,aAAa,MAAM,UAAU,IAAI;AAAA,cACxD,OAAO,KAAK,IAAI,MAAM,aAAa,MAAM,UAAU,IAAI;AAAA,cACvD,cACE,KAAK,IAAI,MAAM,aAAa,MAAM,UAAU,IAAI,IAAI;AAAA,cACtD,UACE,KAAK,IAAI,MAAM,aAAa,MAAM,UAAU,IAAI,IAAI;AAAA,YACxD;AAAA,YACA,WAAW,OAAO;AAAA,YAElB,UAAAA,kCAAA;AAAA,cAAC;AAAA,cAAA;AAAA,gBACC,WAAW,OAAO;AAAA,gBAClB,OAAO;AAAA,kBACL,OAAO,MAAM,QAAQ,QAAQ;AAAA,gBAC/B;AAAA,gBAEC,UAAM,MAAA;AAAA,cAAA;AAAA,YACT;AAAA,UAAA;AAAA,QACF;AAAA,MAAA;AAAA,IAEJ;AAAA,IACC,CAAC,MAAM,YACNA,kCAAA;AAAA,MAAC;AAAA,MAAA;AAAA,QACC,IAAI;AAAA,UACF,YAAY,MAAM,WAAW,KAAK;AAAA,UAClC,OAAO,MAAM,WAAW,KAAK;AAAA,UAC7B,UAAU,MAAM,WAAW,KAAK;AAAA,QAClC;AAAA,QAEC,WAAA,WAAM,OAAO,YAAb,mBAAsB;AAAA,MAAA;AAAA,IACzB;AAAA,EAnDO,EAAA,GAAA,MAAM,OAAO,IAqDxB;AAEJ;"}